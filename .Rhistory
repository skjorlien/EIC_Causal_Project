age == "12" ~ "15-64",
age == "13" ~ "15-64",
age == "14" ~ "65o",
age == "15" ~ "65o",
age == "16" ~ "65o",
age == "17" ~ "65o",
age == "18" ~ "65o"
)) %>%
group_by(year, state, sfip, race, sex, age_group) %>%
summarize(pop = sum(pop))%>%
mutate(sex = case_when(
sex == 1 ~ "m",
sex == 2 ~ "f"
),
race = case_when(
race == 1 ~ "w",
race == 2 ~ "b",
race == 3 ~ "n"
)) %>%
pivot_wider(id_cols = c(year, state, sfip), names_from = c(race, sex, age_group),
names_prefix = "pop_", values_from = pop)  %>%
filter(year >= 2007) %>%
rowwise() %>%
mutate(population = sum(c_across(contains("pop"))))
View(df)
##############################################
# Author: Scott Kjorlien
# Date: 4/30/2022
# Description:
#   take the census csv, and aggregate populations by state, year, race, sex, and age group.
#   output a csv with the aggregated data
#
##############################################
rm(list=ls())
df <- read_csv(here("data/raw/SEER/demographics.csv")) %>%
mutate(pop = as.numeric(pop),
age_group = case_when(
age == "00" ~ "U18",
age == "01" ~ "U18",
age == "02" ~ "U18",
age == "03" ~ "U18",
age == "04" ~ "U18",
age == "05" ~ "15-64",
age == "06" ~ "15-64",
age == "07" ~ "15-64",
age == "08" ~ "15-64",
age == "09" ~ "15-64",
age == "10" ~ "15-64",
age == "11" ~ "15-64",
age == "12" ~ "15-64",
age == "13" ~ "15-64",
age == "14" ~ "65o",
age == "15" ~ "65o",
age == "16" ~ "65o",
age == "17" ~ "65o",
age == "18" ~ "65o"
)) %>%
group_by(year, state, sfip, race, sex, age_group) %>%
summarize(pop = sum(pop))%>%
mutate(sex = case_when(
sex == 1 ~ "m",
sex == 2 ~ "f"
),
race = case_when(
race == 1 ~ "w",
race == 2 ~ "b",
race == 3 ~ "n"
)) %>%
pivot_wider(id_cols = c(year, state, sfip), names_from = c(race, sex, age_group),
names_prefix = "pop_", values_from = pop)  %>%
filter(year >= 2007) %>%
rowwise() %>%
mutate(population = sum(c_across(contains("pop")))) %>%
write_csv(here("data/clean/population.csv"))
##############################################
# Author: Scott Kjorlien
# Date: 4/30/2022
# Description:
#   take the census csv, and aggregate populations by state, year, race, sex, and age group.
#   output a csv with the aggregated data
#
##############################################
rm(list=ls())
df <- read_csv(here("data/raw/SEER/demographics.csv")) %>%
mutate(pop = as.numeric(pop),
age_group = case_when(
age == "00" ~ "U20",
age == "01" ~ "U20",
age == "02" ~ "U20",
age == "03" ~ "U20",
age == "04" ~ "U20",
age == "05" ~ "20-64",
age == "06" ~ "20-64",
age == "07" ~ "20-64",
age == "08" ~ "20-64",
age == "09" ~ "20-64",
age == "10" ~ "20-64",
age == "11" ~ "20-64",
age == "12" ~ "20-64",
age == "13" ~ "20-64",
age == "14" ~ "65o",
age == "15" ~ "65o",
age == "16" ~ "65o",
age == "17" ~ "65o",
age == "18" ~ "65o"
)) %>%
group_by(year, state, sfip, race, sex, age_group) %>%
summarize(pop = sum(pop))%>%
mutate(sex = case_when(
sex == 1 ~ "m",
sex == 2 ~ "f"
),
race = case_when(
race == 1 ~ "w",
race == 2 ~ "b",
race == 3 ~ "n"
)) %>%
pivot_wider(id_cols = c(year, state, sfip), names_from = c(race, sex, age_group),
names_prefix = "pop_", values_from = pop)  %>%
filter(year >= 2007) %>%
rowwise() %>%
mutate(population = sum(c_across(contains("pop")))) %>%
write_csv(here("data/clean/population.csv"))
## Demographics
tdf <- read_csv(here("data/clean/population.csv"))
rm(list=ls())
out.df <- data.frame()
## Demographics
tdf <- read_csv(here("data/clean/population.csv"))
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
head(tdf)
View(tdf)
View(out.df)
out.df <- out.df %>%
left_join(tdf, by="sfip")
View(out.df)
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
View(tdf)
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year"))
View(out.df)
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdgp = m_gdp*1000000/population)
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdgp = m_gdp*1000000/population)
View(out.df)
########################################
# Author: Scott Kjorlien
# Date: 5/8/2022
# Description: take the BEA scraped data for real income per capita,
#   clean it, join the fips codes and output.
########################################
sfips <- fips_codes %>%
select(state_code, state_name) %>%
unique()
df <- read_csv(here("data/raw/BEA/real_inc_per_cap.csv")) %>%
select(GeoName, TimePeriod, DataValue) %>%
rename("state" = GeoName,
"year" = TimePeriod,
"rpcpi" = DataValue) %>%
mutate("state_name" = ifelse(str_detect(state, "\\*"), str_extract(state, "^.*(?=\\s)"), state)) %>%
left_join(sfips, by="state_name") %>%
filter(year >= 2007) %>%
drop_na() %>%
select(state_name, state_code, year, rpcpi) %>%
rename("state" = state_name,
"sfip" = state_code) %>%
write_csv(here("data/clean/personal_income.csv"))
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
head(tdf)
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year"))
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab"))
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
View(tdf)
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year"))
View(out.df)
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(State, -state.y, -state, everything())
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year"))
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(State, -state.y, -state, everything())
View(out.df)
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population)
View(out.df)
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population) %>%
select(-state.y) %>%
rename("state_abbr" = state.x)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year"))
View(out.df)
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population) %>%
select(-state.y) %>%
rename("state_abbr" = state.x)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(state, everything())
View(out.df)
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year"))
View(out.df)
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population) %>%
select(-state.y) %>%
rename("state_abbr" = state.x)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(state, everything())
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(-State)
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population) %>%
select(-state.y) %>%
rename("state_abbr" = state.x)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(state, everything())
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(-State)
write_csv(out.df, here("data/clean/working_data.csv"))
View(out.df)
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population) %>%
select(-state.y) %>%
rename("state_abbr" = state.x)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(state, everything())
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(-State) %>%
filter(year<=2019)
write_csv(out.df, here("data/clean/working_data.csv"))
View(out.df)
out.df %>%
group_by(state) %>%
summarise(n = n())
test <- out.df %>%
group_by(state) %>%
summarise(n = n())
View(test)
663/51
## Create Density
state.area
## Create Density
state
## Create Density
x <- state.area
## Create Density
x <- state.x77
View(x)
y <- state.area
View(x)
maps::county.fips
state_fips
fips_codes
## Create Density
sfips <- fips_codes %>%
select(state_code, state_name) %>%
unique()
sfips
## Create Density
tmp_state <- data.frame(state.name, state.area)
View(tmp_state)
## Create Density
tmp_state <- data.frame(state.name, state.area) %>%
rename("state_name" = state.name,
"state_area" = state.area)
View(tmp_state)
sfips <- fips_codes %>%
select(state_code, state_name) %>%
unique() %>%
left_join(tmp_state)
View(sfips)
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population) %>%
select(-state.y) %>%
rename("state_abbr" = state.x)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(state, everything())
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(-State) %>%
filter(year<=2019)
## Create Density -- Note, You are losing DC intentionally here.
tmp_state <- data.frame(state.name, state.area) %>%
rename("state_name" = state.name,
"state_area" = state.area)
sfips <- fips_codes %>%
select(state_code, state_name) %>%
unique() %>%
left_join(tmp_state) %>%
drop_na() %>%
rename("sfip" = state_code)
out.df <- out.df %>%
left_join(sfips)
View(out.df)
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population) %>%
select(-state.y) %>%
rename("state_abbr" = state.x)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(state, everything())
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(-State) %>%
filter(year<=2019)
## Create Density -- Note, You are losing DC intentionally here.
tmp_state <- data.frame(state.name, state.area) %>%
rename("state_name" = state.name,
"state_area" = state.area)
sfips <- fips_codes %>%
select(state_code, state_name) %>%
unique() %>%
left_join(tmp_state) %>%
drop_na() %>%
rename("sfip" = state_code)
out.df <- out.df %>%
left_join(sfips) %>%
select(-state_name) %>%
mutate(density = population/state_area)
View(out.df)
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population) %>%
select(-state.y) %>%
rename("state_abbr" = state.x)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(state, everything())
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(-State) %>%
filter(year<=2019)
## Create Density -- Note, You are losing DC intentionally here.
tmp_state <- data.frame(state.name, state.area) %>%
rename("state_name" = state.name,
"state_area" = state.area)
sfips <- fips_codes %>%
select(state_code, state_name) %>%
unique() %>%
left_join(tmp_state) %>%
drop_na() %>%
rename("sfip" = state_code)
out.df <- out.df %>%
left_join(sfips) %>%
select(-state_name) %>%
mutate(density = population/state_area) %>%
filter(sfip != 11
)
rm(list=ls())
## Demographics
out.df <- read_csv(here("data/clean/population.csv"))
## GDP
tdf <- read_csv(here("data/clean/state_gdp.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
mutate(rpcgdp = m_gdp*1000000/population) %>%
select(-state.y) %>%
rename("state_abbr" = state.x)
## Personal Income
tdf <- read_csv(here("data/clean/personal_income.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(state, everything())
## Poverty and Labor
tdf <- read_csv(here("data/clean/povlab.csv"))
out.df <- out.df %>%
left_join(tdf, by=c("sfip", "year")) %>%
select(-State) %>%
filter(year<=2019)
## Create Density -- Note, You are losing DC intentionally here.
tmp_state <- data.frame(state.name, state.area) %>%
rename("state_name" = state.name,
"state_area" = state.area)
sfips <- fips_codes %>%
select(state_code, state_name) %>%
unique() %>%
left_join(tmp_state) %>%
drop_na() %>%
rename("sfip" = state_code)
out.df <- out.df %>%
left_join(sfips) %>%
select(-state_name) %>%
mutate(density = population/state_area) %>%
filter(sfip != 11)
write_csv(out.df, here("data/clean/working_data.csv"))
View(out.df)
